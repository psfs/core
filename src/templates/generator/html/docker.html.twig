version: "3.7"

services:
    php:
        container_name: psfs_${APP_ENVIRONMENT:-local}
        image: c15k02k18/php:8.2{$DEBUG:-}
        restart: always
        tty: true
        volumes:
            - .:/app
            - ./docker/php.ini:/usr/local/etc/php/php.ini
        networks:
            - psfs-network
        working_dir: "/app"
        ports:
            -   "${HOST_PORT:-8001}:8080"
        command: 'php -S 0.0.0.0:8080 -t ./html'
        environment:
            XDEBUG_CONFIG: "remote_host=localhost"
            PHP_IDE_CONFIG: "serverName=psfs"
        depends_on:
            - redis
        healthcheck:
            test: ["CMD", "php-fpm", "-t"]
            interval: 1s
            timeout: 3s
            retries: 5

    redis:
        container_name: redis_${APP_ENVIRONMENT:-local}
        restart: always
        image: redis:latest
        networks:
            - psfs-network
        healthcheck:
            test: ["CMD-SHELL", "redis-cli ping | grep PONG"]
            interval: 1s
            timeout: 3s
            retries: 5

networks:
    psfs-network:
        driver: bridge
